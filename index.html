<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VALORYS — Du jeu aux compétences</title>
    <meta name="description" content="Valorys traduit vos performances de jeu en valeur réelle. Découvrez ce que votre rang dit de vos compétences." />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <meta name="theme-color" content="#0B0D17" />
  </head>

  <body>
    <!-- ===== HEADER ===== -->
    <header class="site-header">
      <a href="/" class="brand-logo" aria-label="Accueil Valorys">
        <svg class="valorys-icon" width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M15 20 L50 80 L85 20" stroke="url(#grad1)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="grad1" x1="15" y1="20" x2="85" y2="80" gradientUnits="userSpaceOnUse">
              <stop stop-color="#6546E0"/><stop offset="0.6" stop-color="#4A61FF"/><stop offset="1" stop-color="#EACD5C"/>
            </linearGradient>
          </defs>
        </svg>
        <span class="sr-only">Valorys</span>
      </a>
    </header>

    <!-- ===== HERO ===== -->
    <main class="hero">
      <h1 class="brand-wordmark"><span class="valorys-glow">VALORYS</span></h1>
      <p class="hero-subtitle">Du jeu aux compétences.</p>

      <!-- Bande de jeux (défilement continu) -->
      <section class="games-strip" aria-label="Jeux analysés par Valorys">
        <div class="games-track">
          <img src="https://cdn.simpleicons.org/leagueoflegends/E8E9F0" alt="League of Legends" />
          <img src="https://cdn.simpleicons.org/valorant/E8E9F0" alt="Valorant" />
          <img src="https://cdn.simpleicons.org/counterstrike/E8E9F0" alt="Counter-Strike 2" />
          <img src="https://cdn.simpleicons.org/overwatch/E8E9F0" alt="Overwatch 2" />
          <img src="https://cdn.simpleicons.org/apexlegends/E8E9F0" alt="Apex Legends" />
          <img src="https://cdn.simpleicons.org/rocketdotai/E8E9F0" alt="Rocket League" />
          <!-- copie pour loop fluide -->
          <img src="https://cdn.simpleicons.org/leagueoflegends/E8E9F0" alt="League of Legends" />
          <img src="https://cdn.simpleicons.org/valorant/E8E9F0" alt="Valorant" />
          <img src="https://cdn.simpleicons.org/counterstrike/E8E9F0" alt="Counter-Strike 2" />
          <img src="https://cdn.simpleicons.org/overwatch/E8E9F0" alt="Overwatch 2" />
          <img src="https://cdn.simpleicons.org/apexlegends/E8E9F0" alt="Apex Legends" />
          <img src="https://cdn.simpleicons.org/rocketdotai/E8E9F0" alt="Rocket League" />
        </div>
      </section>

      <!-- ===== Aperçu vivant (démo) ===== -->
      <section class="live-preview" id="livePreview" aria-label="Exemples de résultats">
        <div class="lp-card lp-enter" id="lpCard">
          <div class="lp-header">
            <img id="lpGameIcon" alt="" />
            <span id="lpGameName">Valorant</span>
            <span class="lp-time" id="lpTime">il y a 2 min</span>
          </div>

          <div class="lp-body">
            <div class="lp-rank" id="lpRank">Ascendant II</div>
            <div class="lp-meta" id="lpMeta">≈ Top 8% · Compétence : Vision stratégique</div>

            <div class="lp-meter">
              <div class="lp-meter-fill" id="lpMeterFill" style="width: 62%"></div>
            </div>

            <div class="lp-compare" id="lpCompare">
              <span>≈ LoL : Platine I</span> · <span>CS2 : Master Guardian</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== Module interactif ===== -->
      <div class="hero-input" id="inputBox">
        <input
          type="text"
          id="rankInput"
          placeholder="Ex : Gold IV – LoL / Ascendant – Valorant / Master – Clash Royale"
          autocomplete="off"
          aria-label="Entre ton rang et ton jeu"
        />
        <button id="analyzeButton">Analyser ma valeur</button>
      </div>

      <!-- ===== Historique des recherches ===== -->
      <section class="history" id="history" aria-label="Historique des recherches">
        <div class="history__head">
          <h2>Historique des recherches</h2>
          <button class="ghost-btn small" id="clearHistoryBtn" aria-label="Effacer l'historique">Effacer</button>
        </div>
        <div class="history__list" id="historyList" aria-live="polite"></div>
      </section>

      <!-- Résultat principal -->
      <div class="hero-result" id="resultContainer" style="display:none;">
        <h3 id="resultTitle"></h3>
        <p id="resultText"></p>

        <!-- Mini visualisation -->
        <div class="value-meter" aria-label="Indice de valeur">
          <div class="value-meter__fill" id="valueFill" aria-valuemin="0" aria-valuemax="100"></div>
          <div class="value-meter__ticks">
            <span>Débutant</span><span>Intermédiaire</span><span>Élite</span><span>Légendaire</span>
          </div>
        </div>

        <button id="compareButton" class="ghost-btn">Comparer à d’autres jeux</button>
      </div>
    </main>

    <!-- ===== HOW IT WORKS ===== -->
    <section class="howitworks" id="howitworks" aria-label="Comment ça marche">
      <div class="howitworks__inner">
        <h2 class="howitworks__title reveal-init">Comment ça marche</h2>
        <div class="steps">
          <article class="step-card reveal-init">
            <div class="step-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h10M4 18h7" stroke="#E8E9F0" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <h3>1. Entre ton rang</h3>
            <p>Ex. <em>Gold IV – LoL</em> ou <em>Ascendant – Valorant</em>. Pas besoin de compte.</p>
          </article>

          <article class="step-card reveal-init">
            <div class="step-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 3v18M3 12h18" stroke="#E8E9F0" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <h3>2. Conversion intelligente</h3>
            <p>Nous estimons la rareté de ton niveau et la comparons entre jeux.</p>
          </article>

          <article class="step-card reveal-init">
            <div class="step-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#E8E9F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <h3>3. Ta valeur claire</h3>
            <p>Top %, difficulté, et compétence dominante. Compréhensible en un coup d’œil.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- ===== FOOTER ===== -->
    <footer class="site-footer">
      <div class="footer-inner">
        <a href="/" class="footer-logo" aria-label="Valorys">
          <svg class="footer-icon" width="26" height="26" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M15 20 L50 80 L85 20" stroke="url(#grad2)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="grad2" x1="15" y1="20" x2="85" y2="80" gradientUnits="userSpaceOnUse">
                <stop stop-color="#6546E0"/><stop offset="0.6" stop-color="#4A61FF"/><stop offset="1" stop-color="#EACD5C"/>
              </linearGradient>
            </defs>
          </svg>
          <span>VALORYS</span>
        </a>
        <nav class="footer-nav">
          <a href="#howitworks">Comment ça marche</a>
          <a href="mailto:hello@valorys.app">Contact</a>
          <a href="#">Mentions</a>
          <a href="https://twitter.com" target="_blank" rel="noopener">Twitter</a>
          <a href="https://www.linkedin.com" target="_blank" rel="noopener">LinkedIn</a>
        </nav>
        <small>© <span id="year"></span> Valorys</small>
      </div>
    </footer>

    <!-- ===== SCRIPT ===== -->
    <script>
      const $ = (sel) => document.querySelector(sel);

      const resultContainer = $("#resultContainer");
      const resultTitle = $("#resultTitle");
      const resultText = $("#resultText");
      const analyzeButton = $("#analyzeButton");
      const rankInput = $("#rankInput");
      const compareButton = $("#compareButton");
      const valueFill = $("#valueFill");
      const inputBox = $("#inputBox");

      const historyList = $("#historyList");
      const historyRoot = $("#history");
      const clearHistoryBtn = $("#clearHistoryBtn");

      const norm = (s) => (s || "").toString().trim().toLowerCase();
      const divisionAdjust = { iv: +6, iii: +4, ii: +2, i: 0 };

      function difficultyLabel(p) {
        if (p <= 1) return "Légendaire";
        if (p <= 5) return "Élite";
        if (p <= 10) return "Très élevée";
        if (p <= 25) return "Élevée";
        if (p <= 50) return "Intermédiaire";
        return "Débutant";
      }

      function dominantSkill(t) {
        if (["challenger","radiant","ultimate champion"].includes(t)) return "Leadership & sang-froid";
        if (["grandmaster","immortal","royal champion"].includes(t)) return "Décision sous pression";
        if (["master","champion"].includes(t)) return "Apprentissage rapide";
        if (["diamond","ascendant","grand champion"].includes(t)) return "Vision stratégique";
        if (["emerald","platinum","master (cr)"].includes(t)) return "Constance";
        if (["gold","diamond (cr)","platinum (cr)","challenger (cr)"].includes(t)) return "Gestion des risques";
        return "Progression & résilience";
      }

      const LOL_TIERS = { iron:85, bronze:70, silver:55, gold:40, platinum:25, emerald:15, diamond:8, master:3.5, grandmaster:1.5, challenger:0.1 };
      const VAL_TIERS = { iron:85, bronze:70, silver:55, gold:40, platinum:25, diamond:15, ascendant:8, immortal:2.5, radiant:0.1 };
      const CR_TIERS  = { challenger:60, "master (cr)":40, champion:20, "grand champion":10, "royal champion":4, "ultimate champion":0.5 };

      function detectGame(raw, tierKey) {
        const s = norm(raw);
        if (/(valorant|val\b)/.test(s)) return "valorant";
        if (/(clash|clash royale|cr\b)/.test(s)) return "clash_royale";
        if (/(lol|league of legends|league\b)/.test(s)) return "lol";
        if (["emerald","grandmaster","challenger","iron"].includes(tierKey)) return "lol";
        if (["ascendant","immortal","radiant"].includes(tierKey)) return "valorant";
        if (["ultimate champion","royal champion","grand champion","champion"].includes(tierKey)) return "clash_royale";
        return "valorant";
      }

      function parseRank(raw) {
        const s = norm(raw).replace(/—|–/g, "-");
        const [left, right] = s.split("-").map(x => (x || "").trim());
        const candidate = left || s;

        const tierRegexes = [
          { re: /(radiant|immortal|ascendant|diamond|platinum|gold|silver|bronze|iron)\s*(iv|iii|ii|i)?/ }, // Valorant
          { re: /(challenger|grandmaster|master|diamond|emerald|platinum|gold|silver|bronze|iron)\s*(iv|iii|ii|i)?/ }, // LoL
          { re: /(ultimate champion|royal champion|grand champion|champion|master|challenger)/ } // Clash Royale
        ];

        for (const { re } of tierRegexes) {
          const m = candidate.match(re);
          if (m) {
            const tier = m[1];
            const div = m[2] || null;
            const resolvedGame = detectGame(right || s, norm(tier));
            return { game: resolvedGame, tier, tierKey: norm(tier), division: div ? norm(div) : null };
          }
        }
        return null;
      }

      function computePercentile(meta) {
        const { game, tierKey, division } = meta;
        let base;
        if (game === "lol") base = LOL_TIERS[tierKey];
        else if (game === "valorant") base = VAL_TIERS[tierKey];
        else if (game === "clash_royale") base = CR_TIERS[tierKey === "master" ? "master (cr)" : tierKey];
        if (typeof base !== "number") return null;

        let adj = base;
        if (division && divisionAdjust[division] != null) adj = Math.min(99, base + divisionAdjust[division]);
        if (adj < 0.05) adj = 0.05;
        return Number(adj.toFixed(adj < 1 ? 2 : adj < 10 ? 1 : 0));
      }

      function gameLabel(id) {
        if (id === "lol") return "League of Legends";
        if (id === "valorant") return "Valorant";
        if (id === "clash_royale") return "Clash Royale";
        return "Jeu";
      }

      function titleCaseRank(tier, division) {
        const up = (w) => w.charAt(0).toUpperCase() + w.slice(1);
        const t = tier.split(" ").map(up).join(" ");
        return division ? `${t} ${division.toUpperCase()}` : t;
      }

      // Styles dynamiques de la carte résultat
      function resultStyle(p) {
        if (p <= 5)  return { border:"rgba(234,205,92,.45)", bg:"linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03))", shadow:"0 16px 46px rgba(234,205,92,.28)" };
        if (p <= 15) return { border:"rgba(101,70,224,.45)", bg:"linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03))", shadow:"0 14px 44px rgba(101,70,224,.22)" };
        return           { border:"rgba(101,70,224,.28)", bg:"linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))", shadow:"0 12px 36px rgba(0,0,0,.45)" };
      }

      function setCalculating(on) {
        inputBox.classList.toggle("loading", !!on);
        analyzeButton.disabled = !!on;
      }

      // ===== Historique (localStorage) =====
      const HISTORY_KEY = "valorys_history_v1";
      function saveHistory(item) {
        const list = loadHistory();
        const withId = { ...item, id: Date.now() };
        list.unshift(withId);
        const capped = list.slice(0, 12);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(capped));
        return capped;
      }
      function loadHistory() {
        try { return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]"); }
        catch { return []; }
      }
      function clearHistory() {
        localStorage.removeItem(HISTORY_KEY);
        renderHistory([]);
      }

      function historyCardTemplate(data){
        const diff = difficultyLabel(data.percentile);
        const score = Math.max(0, Math.min(100, 100 - data.percentile));
        return `
          <article class="h-card">
            <header class="h-head">
              <img src="${data.icon}" alt="${data.gameName}" class="h-icon"/>
              <div class="h-titles">
                <strong class="h-game">${data.gameName}</strong>
                <span class="h-time">${data.when || "à l’instant"}</span>
              </div>
              <div class="h-rank">${data.rank}</div>
            </header>
            <div class="h-meta">≈ Top ${data.percentile}% · Compétence : ${data.skill} · Difficulté : ${diff}</div>
            <div class="h-meter" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="${score}">
              <div class="h-meter-fill" style="width:${score}%"></div>
            </div>
            <div class="h-compare">${data.compare.map(c=>`<span>${c}</span>`).join(" · ")}</div>
          </article>
        `;
      }

      function renderHistory(list){
        if (!historyList) return;
        if (!list || list.length === 0){
          historyList.innerHTML = `<div class="history-empty">Aucune recherche pour le moment.<br/>Entre un rang pour commencer.</div>`;
          return;
        }
        historyList.innerHTML = list.map(historyCardTemplate).join("");
      }

      // ===== Aperçu vivant (démo) =====
      const LP_DATA = [
        {
          game: "valorant", gameName: "Valorant",
          icon: "https://cdn.simpleicons.org/valorant/E8E9F0",
          rank: "Ascendant II", percentile: 8, skill: "Vision stratégique",
          compare: ["≈ LoL : Platine I", "CS2 : Master Guardian"], ago: "il y a 2 min"
        },
        {
          game: "lol", gameName: "League of Legends",
          icon: "https://cdn.simpleicons.org/leagueoflegends/E8E9F0",
          rank: "Émeraude IV", percentile: 15, skill: "Constance",
          compare: ["≈ Valorant : Diamant I", "CS2 : DMG"], ago: "il y a 7 min"
        },
        {
          game: "counter-strike", gameName: "Counter-Strike 2",
          icon: "https://cdn.simpleicons.org/counterstrike/E8E9F0",
          rank: "LEM", percentile: 6, skill: "Décision sous pression",
          compare: ["≈ LoL : Diamant IV", "Valorant : Ascendant I"], ago: "il y a 12 min"
        },
        {
          game: "overwatch", gameName: "Overwatch 2",
          icon: "https://cdn.simpleicons.org/overwatch/E8E9F0",
          rank: "Master 3", percentile: 9, skill: "Vision stratégique",
          compare: ["≈ Valorant : Diamant II", "CS2 : MGE"], ago: "il y a 16 min"
        },
        {
          game: "apexlegends", gameName: "Apex Legends",
          icon: "https://cdn.simpleicons.org/apexlegends/E8E9F0",
          rank: "Master", percentile: 1.5, skill: "Leadership & sang-froid",
          compare: ["≈ LoL : Grandmaster", "Valorant : Immortal 1"], ago: "il y a 25 min"
        }
      ];

      const lpRoot = document.getElementById("livePreview");
      const lpCard = document.getElementById("lpCard");
      const lpGameIcon = document.getElementById("lpGameIcon");
      const lpGameName = document.getElementById("lpGameName");
      const lpTime = document.getElementById("lpTime");
      const lpRank = document.getElementById("lpRank");
      const lpMeta = document.getElementById("lpMeta");
      const lpMeterFill = document.getElementById("lpMeterFill");
      const lpCompare = document.getElementById("lpCompare");

      let lpIndex = 0, lpTimer = null;

      function lpSet(data) {
        lpGameIcon.src = data.icon;
        lpGameIcon.alt = data.gameName;
        lpGameName.textContent = data.gameName;
        lpTime.textContent = data.ago;
        lpRank.textContent = data.rank;

        const diff = (data.percentile <= 1) ? "Légendaire" :
                     (data.percentile <= 5) ? "Élite" :
                     (data.percentile <= 10)? "Très élevée" :
                     (data.percentile <= 25)? "Élevée" : "Intermédiaire";

        lpMeta.textContent = `≈ Top ${data.percentile}% · Compétence : ${data.skill} · Difficulté : ${diff}`;
        lpMeterFill.style.width = Math.max(0, Math.min(100, 100 - data.percentile)) + "%";
        lpCompare.innerHTML = data.compare.map(c => `<span>${c}</span>`).join(" · ");
      }

      function lpNext() {
        lpCard.classList.remove("lp-enter");
        lpCard.classList.add("lp-leave");
        setTimeout(() => {
          lpIndex = (lpIndex + 1) % LP_DATA.length;
          lpSet(LP_DATA[lpIndex]);
          lpCard.classList.remove("lp-leave");
          lpCard.offsetHeight; // reflow
          lpCard.classList.add("lp-enter");
        }, 360);
      }

      function lpStart() {
        lpSet(LP_DATA[lpIndex]);
        lpTimer = setInterval(lpNext, 2800);
      }
      lpStart();

      // ===== Rendu résultat + màj historique =====
      function renderResult(meta, p) {
        const g = gameLabel(meta.game);
        const rank = titleCaseRank(meta.tierKey.replace(" (cr)", "") || meta.tier, meta.division);
        const diff = difficultyLabel(p);
        const skill = dominantSkill(meta.tierKey);

        resultTitle.textContent = `Ton rang ${rank} — ${g}`;
        resultText.textContent  = `≈ Top ${p}% des joueurs · Difficulté : ${diff} · Compétence dominante : ${skill}.`;

        const s = resultStyle(p);
        resultContainer.style.display = "block";
        resultContainer.classList.add("show");
        resultContainer.style.borderColor = s.border;
        resultContainer.style.background = s.bg;
        resultContainer.style.boxShadow = `${s.shadow}, 0 0 0 1px rgba(101,70,224,.12) inset`;

        const score = Math.max(0, Math.min(100, 100 - p)); // 0..100
        valueFill.style.width = score + "%";
        valueFill.setAttribute("aria-valuenow", String(score));

        // Ajout à l'historique
        const icon = meta.game === "lol" ? "https://cdn.simpleicons.org/leagueoflegends/E8E9F0"
                    : meta.game === "valorant" ? "https://cdn.simpleicons.org/valorant/E8E9F0"
                    : "https://cdn.simpleicons.org/clashroyale/E8E9F0";
        const item = {
          game: meta.game,
          gameName: g,
          icon,
          rank,
          percentile: p,
          skill,
          compare: buildComparison(meta, p),
          when: "à l’instant"
        };
        const list = saveHistory(item);
        renderHistory(list);
      }

      function buildComparison(meta, p){
        // Comparaisons rapides par mapping simple (inter-jeux approximatif)
        const g = meta.game;
        const rankLoL = ["Débutant","Bronze","Argent","Or","Platine","Émeraude","Diamant","Master","Grandmaster","Challenger"];
        const toLoL = p<=0.2?"Challenger":p<=1.5?"Grandmaster":p<=4?"Master":p<=8?"Diamant I":p<=15?"Émeraude I":p<=25?"Platine I":p<=40?"Or I":"Argent I";
        const toVal = p<=0.2?"Radiant":p<=2.5?"Immortal 1":p<=8?"Ascendant II":p<=15?"Diamant I":p<=25?"Platine II":p<=40?"Or I":"Argent I";
        const toCR  = p<=0.5?"Ultimate Champion":p<=4?"Royal Champion":p<=10?"Grand Champion":p<=20?"Champion":p<=40?"Master":"Challenger";
        if (g === "lol") return [`≈ Valorant : ${toVal}`, `Clash Royale : ${toCR}`];
        if (g === "valorant") return [`≈ LoL : ${toLoL}`, `Clash Royale : ${toCR}`];
        return [`≈ LoL : ${toLoL}`, `Valorant : ${toVal}`];
      }

      function renderError(msg) {
        resultTitle.textContent = "Impossible d’analyser ce rang";
        resultText.textContent  = msg || "Vérifie le format : ex. “Gold IV – LoL”, “Ascendant – Valorant”.";
        resultContainer.style.display = "block";
        resultContainer.classList.add("show");
        valueFill.style.width = "0%";
      }

      function analyze() {
        const raw = rankInput.value.trim();
        if (!raw) return;

        // Masquer la démo à la première recherche
        if (lpRoot && !lpRoot.classList.contains('is-hidden')) {
          lpRoot.classList.add('is-hidden');
          if (lpTimer) clearInterval(lpTimer);
        }

        setCalculating(true);
        resultContainer.style.display = "block";
        resultContainer.classList.add("show");
        resultTitle.textContent = "Analyse en cours…";
        resultText.textContent  = "Évaluation du rang et comparaison…";

        setTimeout(() => {
          const meta = parseRank(raw);
          if (!meta) { setCalculating(false); return renderError(); }
          const pct = computePercentile(meta);
          if (pct == null) { setCalculating(false); return renderError("Rang non reconnu pour ce jeu."); }
          renderResult(meta, pct);
          setCalculating(false);
        }, 420);
      }

      analyzeButton.addEventListener("click", analyze);
      rankInput.addEventListener("keydown", (e) => { if (e.key === "Enter") analyze(); });
      compareButton.addEventListener("click", () => { rankInput.focus(); rankInput.select(); });

      // Footer year
      document.getElementById("year").textContent = new Date().getFullYear();

      // Scroll reveal
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((e) => { if (e.isIntersecting) e.target.classList.add("reveal-visible"); });
      }, { threshold: 0.2 });
      document.querySelectorAll(".reveal-init").forEach((el) => observer.observe(el));

      // Init historique
      renderHistory(loadHistory());
      clearHistoryBtn.addEventListener("click", clearHistory);
    </script>
  </body>
</html>
